model Invoice {
    id Int @id @default(autoincrement())

    invoiceNumber String   @unique
    invoiceDate   DateTime

    invoiceType       String // TAX_INVOICE
    reverseCharge     Boolean @default(false)
    currency          String  @default("INR")
    // ðŸ”— CORE LINK
    po_id             Int
    sellerId          Int
    consigneeId       Int?
    taxDetailId       Int?
    amountSummaryId   Int?
    transportDetailId Int?
    auditDetailId     Int?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    // ðŸ”— RELATIONS
    po        PO      @relation(fields: [po_id], references: [id])
    seller    Vendor  @relation("seller", fields: [sellerId], references: [id])
    buyer     String?
    consignee Vendor? @relation("consignee", fields: [consigneeId], references: [id])

    taxDetail       TaxDetail?
    amountSummary   InvoiceAmountSummary?
    transportDetail TransportDetail?
    auditDetail     InvoiceAudit?

    items                  InvoiceItem[]
    invoiceAmountSummaryId Int?
    invoiceAuditId         Int?
    user                   User?         @relation(fields: [userId], references: [id])
    userId                 Int?

    @@map("invoice")
}

model InvoiceItem {
    id Int @id @default(autoincrement())

    invoiceId               Int
    grn_id                  Int
    grn_material_receipt_id Int

    basicAmount          Float?
    taxableValue         Float?
    freightRatePerUnit   Float?
    unloadingRatePerUnit Float?

    invoice Invoice            @relation(fields: [invoiceId], references: [id])
    grn     GRN                @relation(fields: [grn_id], references: [id])
    grnItem GRNMaterialReceipt @relation(fields: [grn_material_receipt_id], references: [id])

    @@index([grn_id])
    @@map("invoice_item")
}

model TaxDetail {
    id Int @id @default(autoincrement())

    cgstRate   Float?
    cgstAmount Float?

    sgstRate   Float?
    sgstAmount Float?

    igstRate   Float?
    igstAmount Float?

    totalTax Float?

    invoice   Invoice? @relation(fields: [invoiceId], references: [id])
    invoiceId Int?     @unique

    @@map("tax_detail")
}

model InvoiceAmountSummary {
    id Int @id @default(autoincrement())

    goodsValue   Float?
    taxableValue Float?

    freightAmount   Float?
    unloadingAmount Float?

    roundOff Float?

    totalTaxAmount    Float?
    totalInvoiceValue Float?

    amountInWords String

    invoice   Invoice? @relation(fields: [invoiceId], references: [id])
    invoiceId Int?     @unique

    @@map("invoice_amount_summary")
}

model TransportDetail {
    id Int @id @default(autoincrement())

    transporterName  String
    transporterGstin String?

    vehicleNumber String?
    wagonNumber   String?

    transportMode String // ROAD / RAIL
    lrRrNo        String?
    lrRrDate      DateTime?

    dispatchFrom String?
    destination  String?
    distanceKm   Int?

    invoice   Invoice? @relation(fields: [invoiceId], references: [id])
    invoiceId Int?     @unique

    @@map("transport_detail")
}

model InvoiceAudit {
    id Int @id @default(autoincrement())

    preparedBy   String?
    checkedBy    String?
    authorizedBy String?

    declaration     String?
    termsConditions String?

    invoice   Invoice? @relation(fields: [invoiceId], references: [id])
    invoiceId Int?     @unique

    @@map("invoice_audit")
}
