model DPR {
    id Int @id @default(autoincrement())

    date DateTime

    project_id         Int
    weather_conditions String

    safety_incidents String?
    remarks          String?

    submitted_by   Int
    material_cost  Float
    labour_cost    Float
    machinery_cost Float
    total_cost     Float
    Dimension      String?

    // Relations
    project Project @relation(fields: [project_id], references: [id], onDelete: Cascade)
    user    User    @relation(fields: [submitted_by], references: [id], onDelete: Cascade)

    materials DPRMaterialConsumption[]
    labours   DPRLabourConsumption[]
    machinery DPRMachineryUsage[]

    created_at DateTime  @default(now())
    updated_at DateTime  @updatedAt
    dprfiles   DPRFile[]

    @@index([project_id])
    @@index([date])
}

model DPRMaterialConsumption {
    id Int @id @default(autoincrement())

    dpr_id      Int
    material_id Int

    quantity Float
    rate     Float?
    amount   Float

    chainage_from String?
    chainage_to   String?

    dpr        DPR      @relation(fields: [dpr_id], references: [id], onDelete: Cascade)
    material   Material @relation(fields: [material_id], references: [id], onDelete: Cascade)
    created_at DateTime @default(now())
}

model DPRLabourConsumption {
    id Int @id @default(autoincrement())

    dpr_id Int

    skill   String
    hours   Float
    charges Float

    chainage_from String?
    chainage_to   String?

    dpr     DPR         @relation(fields: [dpr_id], references: [id], onDelete: Cascade)
    labours DPRLabour[]

    created_at DateTime @default(now())
}

model DPRLabour {
    id Int @id @default(autoincrement())

    dpr_labour_consumption_id Int
    labour_id                 Int

    labourConsumption DPRLabourConsumption @relation(fields: [dpr_labour_consumption_id], references: [id], onDelete: Cascade)

    labour Labour @relation(fields: [labour_id], references: [id], onDelete: Cascade)

    @@unique([dpr_labour_consumption_id, labour_id])
}

model DPRMachineryUsage {
    id Int @id @default(autoincrement())

    dpr_id Int

    machine_code String?
    machine_name String

    chainage_from String?
    chainage_to   String?

    working_hours Float

    fuel_type     String?
    fuel_consumed String?
    fuel_amount   String?

    dpr DPR @relation(fields: [dpr_id], references: [id], onDelete: Cascade)

    created_at DateTime @default(now())
}

model DPRFile {
    id      Int @id @default(autoincrement())
    dpr_id  Int
    file_id Int

    dpr  DPR  @relation(fields: [dpr_id], references: [id], onDelete: Cascade)
    file File @relation(fields: [file_id], references: [id], onDelete: Cascade)

    @@unique([dpr_id, file_id])
}
