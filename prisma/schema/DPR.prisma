enum Site_type {
    LHS
    RHS
    BHS
}

model DPR {
    id Int @id @default(autoincrement())

    date         DateTime
    project_id   Int
    submitted_by Int

    project Project       @relation(fields: [project_id], references: [id], onDelete: Cascade)
    user    User          @relation(fields: [submitted_by], references: [id], onDelete: Cascade)
    entries DPRChainage[]

    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    @@index([project_id])
    @@index([date])
    @@map("dprs")
}

model DPRChainage {
    id Int @id @default(autoincrement())

    dpr_id Int
    dpr    DPR @relation(fields: [dpr_id], references: [id], onDelete: Cascade)

    site          Site_type
    chainage_from String
    chainge_to    String
    category      String

    activity_id Int
    activity    Activity @relation(fields: [activity_id], references: [id], onDelete: Cascade)

    material_id Int
    material    Material @relation(fields: [material_id], references: [id], onDelete: Cascade)

    number Int
    length Int
    width  Int
    depth  Int

    unit_id Int
    unit    Unit @relation(fields: [unit_id], references: [id], onDelete: Cascade)

    quantity      Int
    plan_quantity Int

    created_at DateTime  @default(now())
    updated_at DateTime  @updatedAt
    images     DPRFile[]

    @@index([dpr_id])
    @@map("dpr_chainages")
}

model DPRFile {
    id      Int @id @default(autoincrement())
    dpr_id  Int
    file_id Int

    file File        @relation(fields: [file_id], references: [id], onDelete: Cascade)
    dpr  DPRChainage @relation(fields: [dpr_id], references: [id], onDelete: Cascade)

    @@unique([dpr_id, file_id])
    @@map("dpr_files")
}
